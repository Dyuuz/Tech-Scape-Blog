{% extends 'layout.html' %}
{%load static%}

{% block hero %}

{% endblock  %}

{%block featured%}
<div class="blog-register-body">
    <div class="blog-register-container">
      <section class="forms-section">
        <h1 class="section-title-login">Welcome to Tech-Scape </h1>
        <p class="log-title">Input credentials to continue</p>
      </section>
      <form class="blog-register-form" id="loginForm" method="POST">
          {% csrf_token %}
          <h6 class="newh6">Name</h6> 
          <input class="blog-register-input" type="text" name="username" placeholder="Input username" autocomplete="on" required>
          
          <h6 class="newh6">Password</h6> 
          <input class="blog-register-input" id="password" type="password" name="password" placeholder="Input password" required>
          
          <p class="blog-register-alert">
            
          </p>
            <button class="blog-register-button" type="submit" >Login</button>
      </form>
      <p class="blog-register-text">
          Don't have an account? <a href="{% url 'register' %}">Register</a>
      </p>
      <p class="blog-register-password">
          <a href="{% url 'verify' %}">Forgot password?</a>
      </p>
      <script>
        document.getElementById('loginForm').onsubmit = function(event) {
          var password = document.getElementById('password').value;
          var alert = document.querySelector('.blog-register-alert');
          var form = document.getElementById('loginForm');
          var formData = new FormData(form);
          this.action = getLoginUrl(formData);
        };

        function getLoginUrl(formData) {
          var alert =  document.querySelector('.blog-register-alert');
          alert.style.display = 'block';
          const csrf_token = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

          axios.post('login', formData,
          { headers: {
            'X-CSRFToken': csrf_token
          }}
          )
          .then(response => {
            if (response.data.success === true) {
              //alert.textContent = response.data.message;
              window.location.href = response.data.redirect_url;
              
            } else if (response.data.exceptionError === true) {
              alert.textContent = response.data.message;

            } else if(response.data.userError === true) {
              alert.textContent = response.data.message;

            } else if(response.data.passworderror === true) {
              alert.textContent = response.data.message;
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert.textContent = 'An error occurred. Please try again.';
          });
          event.preventDefault();
        }

        function submitForm() {
          var passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/;
          if (!passwordPattern.test(password)) {
            alert.style.display = 'block';
            alert.textContent = 'Password must be at least 8 characters long, include both upper and lower case letters, a number, and a special character.';
            
            setTimeout(function() {
              alert.style.display = 'none';
            }, 10000); 
            event.preventDefault(); 
          }
          
      }
      
      </script>
    </div>
</div>
{% endblock  %}

{% block usercontents %}

{% endblock  %}

{% block populartags %}

{% endblock  %}

{% block recents %}

{% endblock  %}